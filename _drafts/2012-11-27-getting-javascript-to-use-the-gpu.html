---
layout: post
title: Getting javascript to use the GPU
date: 2012-11-27 16:55:34.000000000 +00:00
categories:
- GPU
- Javascript
tags: []
status: draft
type: post
published: false
meta:
  _edit_last: '1'
  _syntaxhighlighter_encoded: '1'
---
<p><strong>tl;dr</strong> A you-should-never-use-this-in-productionâ„¢ proof of concept code that allows parrallel logical operations (and, or, not, xor) to execute on the GPU from javascript. Speed improvement of up to X% are shown in some situations.</p>
<p>Javascript is currently enjoying massive speed ups - with browsers makers putting in great effort to make their javascript engines run like F1 cars. With these lighting fast engines and useful APIs (e.g. Web Workers) modern developers can squeeze every last bit of performance out of the CPU.</p>
<p>But while the CPU is being fully utilized the GPU often lies dormant. For highly parallelizable code this represents a massive amount of unused processing power. There are <a href="http://blip.tv/jsconf/jsconf2012-jarred-nicholls-6143904">some efforts</a> to get javascript to play nice with the GPU in the future, wouldn't it be nice if JavaScript could run jobs on the GPU in today's browsers? Something like the long abandoned webCL project.</p>
<p>To see how this is possible a step back is needed - along side the push for better javascript engines there as also been a trend towards hardware acceleration, taking operations that used to be done in software and moving them to dedicated hardware within the computer. Arguably the biggest gains have been for the &lt;canvas&gt; element: in trying to get web graphics to be as fast as possible many canvas operations are moved across to the GPU. If we carefully control the inputs to these operations then we can highjack the GPU's power for our own purposes.</p>
<p>This post is about getting the simplest operations running on the GPU: logical operations. Luckily there's part of the &lt;canvas&gt; API that's perfect for this - globalCompositeOperation. GlobalCompositeOperation sets how new additions to a canvas interact with what's currently on the canvas:<br />
[caption id="attachment_262" align="aligncenter" width="490"]<img src="assets/Screen-Shot-2012-11-15-at-15.26.52.png" alt="" title="globalCompositeOperation" width="490" height="420" class="size-full wp-image-262" /> globalCompositeOperation example of a red circle being placed on a blue square, from <a href="https://developer.mozilla.org/samples/canvas-tutorial/6_1_canvas_composite.html">MDN</a>[/caption]</p>
<p>By representing a transparent square as a 0 and a solid square (irrespective of colour) as 1 then all logic operators can be built up:<br />
[table id=2 /]<br />
and whilst NOR and NAND can't be done in one operation they can easily be constructed using two of the above.</p>
<h2>Implementation</h2>
<p>Since the setup code will be the same no matter the application I put together a little javascript library to abstracted the &lt;canvas&gt; backend:<br />
[code lang="js"]<br />
// Set the size of the canvas used (in this case 512*512)<br />
var cmsize = 512;<br />
// Start the canvas maths library<br />
CanvasMaths.start(cmsize);<br />
[/code]</p>
